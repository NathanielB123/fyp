{-# OPTIONS --prop --rewriting --show-irrelevant #-}

open import Utils
open import Utils.IdExtras

open import Dependent.SCBool.Syntax
open import Dependent.SCBool.MutualInd

module Dependent.SCBool.Model where

âŸ¦CtxâŸ§ : Setâ‚
âŸ¦CtxâŸ§ = Set

âŸ¦TyâŸ§ : âŸ¦CtxâŸ§ â†’ Setâ‚
âŸ¦TyâŸ§ Î“ = Î“ â†’ Set

âŸ¦TmâŸ§ : âˆ€ Î“ â†’ âŸ¦TyâŸ§ Î“ â†’ Set
âŸ¦TmâŸ§ Î“ A = âˆ€ Ï â†’ A Ï

âŸ¦TmsâŸ§ : âŸ¦CtxâŸ§ â†’ âŸ¦CtxâŸ§ â†’ Set
âŸ¦TmsâŸ§ Î” Î“ = Î” â†’ Î“

variable
  âŸ¦Î“âŸ§ âŸ¦Î“â‚âŸ§ âŸ¦Î“â‚‚âŸ§ âŸ¦Î”â‚âŸ§ âŸ¦Î”â‚‚âŸ§ : âŸ¦CtxâŸ§
  âŸ¦AâŸ§ âŸ¦BâŸ§ âŸ¦Aâ‚âŸ§ âŸ¦Aâ‚‚âŸ§ âŸ¦Bâ‚âŸ§ âŸ¦Bâ‚‚âŸ§ : âŸ¦TyâŸ§ âŸ¦Î“âŸ§ 
  âŸ¦tâ‚âŸ§ âŸ¦tâ‚‚âŸ§ : âŸ¦TmâŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§

  Î“â‰¡ : âŸ¦Î“â‚âŸ§ â‰¡á´¾ âŸ¦Î“â‚‚âŸ§


Tyâ‰¡ : âŸ¦Î“â‚âŸ§ â‰¡á´¾ âŸ¦Î“â‚‚âŸ§ â†’ âŸ¦TyâŸ§ âŸ¦Î“â‚âŸ§ â‰¡á´¾ âŸ¦TyâŸ§ âŸ¦Î“â‚‚âŸ§
Tyâ‰¡ refl = refl

Tmâ‰¡ : âˆ€ Î“â‰¡ â†’ âˆ€ (Aâ‰¡ : âŸ¦Aâ‚âŸ§ â‰¡[ Tyâ‰¡ Î“â‰¡ ]â‰¡á´¾ âŸ¦Aâ‚‚âŸ§) 
    â†’ âŸ¦TmâŸ§ âŸ¦Î“â‚âŸ§ âŸ¦Aâ‚âŸ§ â‰¡á´¾ âŸ¦TmâŸ§ âŸ¦Î“â‚‚âŸ§ âŸ¦Aâ‚‚âŸ§
Tmâ‰¡ refl refl = refl

Tmsâ‰¡ : âŸ¦Î”â‚âŸ§ â‰¡á´¾ âŸ¦Î”â‚‚âŸ§ â†’ âŸ¦Î“â‚âŸ§ â‰¡á´¾ âŸ¦Î“â‚‚âŸ§ â†’ âŸ¦TmsâŸ§ âŸ¦Î”â‚âŸ§ âŸ¦Î“â‚âŸ§ â‰¡á´¾ âŸ¦TmsâŸ§ âŸ¦Î”â‚‚âŸ§ âŸ¦Î“â‚‚âŸ§
Tmsâ‰¡ refl refl = refl

âŸ¦,âŸ§ = Î£

,â‰¡ : âˆ€ Î“â‰¡ â†’ âŸ¦Aâ‚âŸ§ â‰¡[ Tyâ‰¡ Î“â‰¡ ]â‰¡á´¾ âŸ¦Aâ‚‚âŸ§ â†’ âŸ¦,âŸ§ âŸ¦Î“â‚âŸ§ âŸ¦Aâ‚âŸ§ â‰¡á´¾ âŸ¦,âŸ§ âŸ¦Î“â‚‚âŸ§ âŸ¦Aâ‚‚âŸ§ 
,â‰¡ refl refl = refl

âŸ¦Î âŸ§ : âˆ€ âŸ¦AâŸ§ â†’ âŸ¦TyâŸ§ (âŸ¦,âŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§) â†’ âŸ¦TyâŸ§ âŸ¦Î“âŸ§
âŸ¦Î âŸ§ âŸ¦AâŸ§ âŸ¦BâŸ§ = Î» Ï â†’ âˆ€ x â†’ âŸ¦BâŸ§ (Ï Î£, x)

âŸ¦ğ”¹âŸ§ : âŸ¦TyâŸ§ âŸ¦Î“âŸ§
âŸ¦ğ”¹âŸ§ = Î» _ â†’ Bool

ğ”¹â‰¡ : âˆ€ (Î“â‰¡ : âŸ¦Î“â‚âŸ§ â‰¡á´¾ âŸ¦Î“â‚‚âŸ§) â†’ âŸ¦ğ”¹âŸ§ â‰¡[ Tyâ‰¡ Î“â‰¡ ]â‰¡á´¾ âŸ¦ğ”¹âŸ§
ğ”¹â‰¡ refl = refl

Î â‰¡ : âˆ€ Î“â‰¡ Aâ‰¡ â†’ âŸ¦Bâ‚âŸ§ â‰¡[ Tyâ‰¡ (,â‰¡ Î“â‰¡ Aâ‰¡) ]â‰¡á´¾ âŸ¦Bâ‚‚âŸ§
     â†’ âŸ¦Î âŸ§ âŸ¦Aâ‚âŸ§ âŸ¦Bâ‚âŸ§ â‰¡[ Tyâ‰¡ Î“â‰¡ ]â‰¡á´¾ âŸ¦Î âŸ§ âŸ¦Aâ‚‚âŸ§ âŸ¦Bâ‚‚âŸ§
Î â‰¡ refl refl refl = refl



âŸ¦_âŸ§Sortâ„“ : Sort â†’ Level

âŸ¦ ctx     âŸ§Sortâ„“ = 1â„“
âŸ¦ ty _    âŸ§Sortâ„“ = 1â„“
âŸ¦ tm _ _  âŸ§Sortâ„“ = 0â„“
âŸ¦ tms _ _ âŸ§Sortâ„“ = 0â„“

âŸ¦_âŸ§Sort : âˆ€ ğ’® â†’ Set âŸ¦ ğ’® âŸ§Sortâ„“

âŸ¦_âŸ§_ : Syn ğ’® â†’ SortMarker ğ’® â†’ âŸ¦ ğ’® âŸ§Sort
âŸ¦_âŸ§Ctx : Ctx â†’ âŸ¦CtxâŸ§
âŸ¦_âŸ§Ty  : Ty Î“ â†’ âŸ¦TyâŸ§ âŸ¦ Î“ âŸ§Ctx
âŸ¦_âŸ§Tm  : Tm Î“ A â†’ âŸ¦TmâŸ§ âŸ¦ Î“ âŸ§Ctx âŸ¦ A âŸ§Ty
âŸ¦_âŸ§Tms : Tms Î” Î“ â†’ âŸ¦TmsâŸ§ âŸ¦ Î” âŸ§Ctx âŸ¦ Î“ âŸ§Ctx

âŸ¦ ctx     âŸ§Sort = Set
âŸ¦ ty Î“    âŸ§Sort = âŸ¦TyâŸ§ âŸ¦ Î“ âŸ§Ctx
âŸ¦ tm Î“ A  âŸ§Sort = âŸ¦TmâŸ§ âŸ¦ Î“ âŸ§Ctx âŸ¦ A âŸ§Ty
âŸ¦ tms Î” Î“ âŸ§Sort = âŸ¦TmsâŸ§ âŸ¦ Î” âŸ§Ctx âŸ¦ Î“ âŸ§Ctx

âŸ¦_âŸ§Ctx = âŸ¦_âŸ§ CTX
âŸ¦_âŸ§Ty  = âŸ¦_âŸ§ TY
âŸ¦_âŸ§Tm  = âŸ¦_âŸ§ TM
âŸ¦_âŸ§Tms = âŸ¦_âŸ§ TMS

-- {-# INLINE âŸ¦_âŸ§Ctx #-}
-- {-# INLINE âŸ¦_âŸ§Ty #-}
-- {-# INLINE âŸ¦_âŸ§Tm #-}
-- {-# INLINE âŸ¦_âŸ§Tms #-}

variable
  Ï Ïâ‚ Ïâ‚‚ : âŸ¦ Î“ âŸ§Ctx

âŸ¦_âŸ§Ctx~á´¾ : Ctx~ Î“â‚ Î“â‚‚ â†’ âŸ¦ Î“â‚ âŸ§Ctx â‰¡á´¾ âŸ¦ Î“â‚‚ âŸ§Ctx
-- âŸ¦_âŸ§Ctx~ : Ctx~ Î“â‚ Î“â‚‚ â†’ âŸ¦ Î“â‚ âŸ§Ctx â‰¡ âŸ¦ Î“â‚‚ âŸ§Ctx
âŸ¦_âŸ§Ty~á´¾  : Ty~ Î“~ Aâ‚ Aâ‚‚ â†’ âŸ¦ Aâ‚ âŸ§Ty â‰¡[ congá´¾ âŸ¦TyâŸ§ âŸ¦ Î“~ âŸ§Ctx~á´¾ ]â‰¡á´¾ âŸ¦ Aâ‚‚ âŸ§Ty
-- âŸ¦_âŸ§Ty~  : Ty~ Î“~ Aâ‚ Aâ‚‚ â†’ âŸ¦ Aâ‚ âŸ§Ty â‰¡[ cong âŸ¦TyâŸ§ âŸ¦ Î“~ âŸ§Ctx~ ]â‰¡ âŸ¦ Aâ‚‚ âŸ§Ty

-- âŸ¦ A~ âŸ§Ty~  = â‰¡[]â†‘ {p = cong âŸ¦TyâŸ§ âŸ¦ _ âŸ§Ctx~ } âŸ¦ A~ âŸ§Ty~á´¾
-- âŸ¦ Î“~ âŸ§Ctx~ = â‰¡â†‘   âŸ¦ Î“~ âŸ§Ctx~á´¾

-- {-# INLINE âŸ¦_âŸ§Ctx~ #-}
-- {-# INLINE âŸ¦_âŸ§Ty~ #-}

-- âŸ¦_âŸ§Tm~á´¾  : Tm~ Î“~ A~ tâ‚ tâ‚‚ â†’ âˆ€ (Ï~ : Ïâ‚ â‰¡[ âŸ¦ Î“~ âŸ§Ctx~á´¾ ]â‰¡á´¾ Ïâ‚‚)
--          â†’ âŸ¦ tâ‚ âŸ§Tm Ïâ‚ â‰¡[ âŸ¦ A~ âŸ§Ty~á´¾ Ï~ ]â‰¡á´¾ âŸ¦ tâ‚‚ âŸ§Tm Ïâ‚‚


-- âŸ¦_âŸ§Tm~  : Tm~ Î“~ A~ tâ‚ tâ‚‚ 
--         â†’ âŸ¦ tâ‚ âŸ§Tm â‰¡[ dcongâ‚‚ âŸ¦TmâŸ§ âŸ¦ Î“~ âŸ§Ctx~ âŸ¦ A~ âŸ§Ty~ ]â‰¡ âŸ¦ tâ‚‚ âŸ§Tm



âŸ¦ğ”¹âŸ§â€² : âŸ¦ ğ”¹ {Î“ = Î“} âŸ§Ty â‰¡á´¾ Î» Ï â†’ Bool 
âŒœâŒğ”¹â‰¡ : âŸ¦ âŒœ b âŒğ”¹ âŸ§Tm â‰¡[ Tmâ‰¡ (refl {x = âŸ¦ Î“ âŸ§Ctx}) âŸ¦ğ”¹âŸ§â€² ]â‰¡á´¾ Î» Ï â†’ b



Tyâ‰¡-inst : âŸ¦Aâ‚âŸ§ â‰¡á´¾ âŸ¦Aâ‚‚âŸ§ â†’ âŸ¦Aâ‚âŸ§ Ï â‰¡á´¾ âŸ¦Aâ‚‚âŸ§ Ï
Tyâ‰¡-inst refl = refl

-- âŸ¦_âŸ§Tm~á´¾  : Tm~ Î“~ A~ tâ‚ tâ‚‚ 
--          â†’ âŸ¦ tâ‚ âŸ§Tm â‰¡[ Tmâ‰¡ âŸ¦ Î“~ âŸ§Ctx~á´¾ âŸ¦ A~ âŸ§Ty~á´¾ ]â‰¡á´¾ âŸ¦ tâ‚‚ âŸ§Tm
-- foo : Tm~ Î“~ A~ tâ‚ tâ‚‚ â†’ (âŸ¦ tâ‚ âŸ§Tm Ï â‰¡[ Tyâ‰¡-inst âŸ¦ A~ âŸ§Ty~á´¾ ]â‰¡á´¾ âŸ¦ tâ‚‚ âŸ§Tm Ï)

âŸ¦_âŸ§Tm~á´¾ :  Tm~ Î“~ A~ tâ‚ tâ‚‚ â†’ (âŸ¦ tâ‚ âŸ§Tm Ï â‰¡[ Tyâ‰¡-inst âŸ¦ A~ âŸ§Ty~á´¾ ]â‰¡á´¾ âŸ¦ tâ‚‚ âŸ§Tm Ï)

Tmâ‰¡-inst : âˆ€ {âŸ¦tâ‚âŸ§ : âŸ¦TmâŸ§ âŸ¦ Î“ âŸ§Ctx (Î» _ â†’ Bool)} 
         â†’ âŸ¦tâ‚âŸ§ â‰¡á´¾ âŸ¦tâ‚‚âŸ§ â†’ âŸ¦tâ‚âŸ§ Ï â‰¡á´¾ âŸ¦tâ‚‚âŸ§ Ï
Tmâ‰¡-inst refl = refl

âŸ¦ Îµ     âŸ§ CTX = âŠ¤
âŸ¦ Î“ , A âŸ§ CTX = Î£ âŸ¦ Î“ âŸ§Ctx âŸ¦ A âŸ§Ty

âŸ¦ ğ”¹ âŸ§ TY = Î» Ï â†’ Bool

âŸ¦ Î“ , t >rw b âŸ§ CTX = Î£ âŸ¦ Î“ âŸ§Ctx (Î» Ï â†’ âŸ¦ t âŸ§Tm Ï â‰¡ b)

âŸ¦ coe~ Î“~ A âŸ§ TY = coeá´¾ (Tyâ‰¡ âŸ¦ Î“~ âŸ§Ctx~á´¾) âŸ¦ A âŸ§Ty
âŸ¦ Î  A B     âŸ§ TY = Î» Ï â†’ âˆ€ x â†’ âŸ¦ B âŸ§Ty (Ï Î£, x)
âŸ¦ A [ Î´ ]   âŸ§ TY = Î» Ï â†’ âŸ¦ A âŸ§Ty (âŸ¦ Î´ âŸ§Tms Ï)
âŸ¦ if t A B  âŸ§ TY = Î» Ï â†’ Bool-rec (âŸ¦ t âŸ§Tm Ï) (âŸ¦ A âŸ§Ty Ï) (âŸ¦ B âŸ§Ty Ï)

âŸ¦ coe~ Î“~ A~ t âŸ§ TM = coeá´¾ (Tmâ‰¡ âŸ¦ Î“~ âŸ§Ctx~á´¾ âŸ¦ A~ âŸ§Ty~á´¾) âŸ¦ t âŸ§Tm

âŸ¦ Æ› t     âŸ§ TM = Î» Ï        x â†’ âŸ¦ t âŸ§Tm (Ï Î£, x)
âŸ¦ Æ›â»Â¹ t   âŸ§ TM = Î» (Ï Î£, x)   â†’ âŸ¦ t âŸ§Tm Ï x
âŸ¦ TT      âŸ§ TM = Î» Ï          â†’ true
âŸ¦ FF      âŸ§ TM = Î» Ï          â†’ false
âŸ¦ t [ Î´ ] âŸ§ TM = Î» Ï          â†’ âŸ¦ t âŸ§Tm (âŸ¦ Î´ âŸ§Tms Ï)

âŸ¦ Ï€â‚ Î´  âŸ§ TMS = Î» Ï â†’ âŸ¦ Î´ âŸ§Tms Ï .fst

âŸ¦ Ï€â‚‚ Î´  âŸ§ TM = Î» Ï â†’ âŸ¦ Î´ âŸ§Tms Ï .snd

âŸ¦ id     âŸ§ TMS = Î» Ï â†’ Ï
âŸ¦ Ï€â‚rw Î´ âŸ§ TMS = Î» Ï â†’ âŸ¦ Î´ âŸ§Tms Ï .fst

âŸ¦ if t u v âŸ§ TM = Î» Ï â†’ Bool-split (âŸ¦ t âŸ§Tm Ï) (Î» t~ â†’ âŸ¦ u âŸ§Tm (Ï Î£, t~)) 
                                               (Î» t~ â†’ âŸ¦ v âŸ§Tm (Ï Î£, t~))
                                          
âŸ¦ coe~ Î”~ Î“~ Î´ âŸ§ TMS = coeá´¾ (Tmsâ‰¡ âŸ¦ Î”~ âŸ§Ctx~á´¾ âŸ¦ Î“~ âŸ§Ctx~á´¾) âŸ¦ Î´ âŸ§Tms
âŸ¦ Îµ            âŸ§ TMS = Î» Ï â†’ tt
âŸ¦ Î´ , t        âŸ§ TMS = Î» Ï â†’ âŸ¦ Î´ âŸ§Tms Ï Î£, âŸ¦ t âŸ§Tm Ï
âŸ¦ ,rwâ„± {Î” = Î”} Î´ refl refl t~ âŸ§ TMS 
  = Î» Ï â†’ âŸ¦ Î´ âŸ§Tms Ï Î£, â‰¡â†‘ (âŸ¦ t~ âŸ§Tm~á´¾ âˆ™á´¾ Tmâ‰¡-inst {Î“ = Î”} âŒœâŒğ”¹â‰¡)
  -- Tmâ‰¡-inst {Î“ = Î”} (âŸ¦ t~ âŸ§Tm~á´¾
  -- (â‰¡â†‘ (Tmâ‰¡-inst {Î“ = Î”} (âŸ¦ t~ âŸ§Tm~á´¾ âˆ™á´¾ âŒœâŒğ”¹â‰¡)))
âŸ¦ Î´ â¨¾ Ïƒ        âŸ§ TMS = Î» Ï â†’ âŸ¦ Î´ âŸ§Tms (âŸ¦ Ïƒ âŸ§Tms Ï)

âŸ¦ğ”¹âŸ§â€² = refl

âŒœâŒğ”¹â‰¡ {b = false} = refl
âŒœâŒğ”¹â‰¡ {b = true}  = refl

âŸ¦ rfl~ âŸ§Ctx~á´¾         = refl
âŸ¦ sym~ Î“~ âŸ§Ctx~á´¾      = symá´¾ âŸ¦ Î“~ âŸ§Ctx~á´¾
âŸ¦ Î“â‚â‚‚~ âˆ™~ Î“â‚‚â‚ƒ~ âŸ§Ctx~á´¾ = âŸ¦ Î“â‚â‚‚~ âŸ§Ctx~á´¾ âˆ™á´¾ âŸ¦ Î“â‚‚â‚ƒ~ âŸ§Ctx~á´¾
âŸ¦ Î“~ , A~ âŸ§Ctx~á´¾      = ,â‰¡ âŸ¦ Î“~ âŸ§Ctx~á´¾ âŸ¦ A~ âŸ§Ty~á´¾
âŸ¦ Î“~ , t~ >rw âŸ§Ctx~á´¾  = {!!}

âŸ¦ rfl~              âŸ§Ty~á´¾ = refl
âŸ¦ sym~ A~           âŸ§Ty~á´¾ = sym[]á´¾ âŸ¦ A~ âŸ§Ty~á´¾
âŸ¦ Aâ‚â‚‚~ âˆ™~ Aâ‚‚â‚ƒ~      âŸ§Ty~á´¾ = {!   !}
âŸ¦ coh               âŸ§Ty~á´¾ = {!!}
âŸ¦ ğ”¹ {Î“~ = Î“~}       âŸ§Ty~á´¾ = ğ”¹â‰¡ âŸ¦ Î“~ âŸ§Ctx~á´¾
âŸ¦ Î  {Î“~ = Î“~} A~ B~ âŸ§Ty~á´¾ = Î â‰¡ âŸ¦ Î“~ âŸ§Ctx~á´¾ âŸ¦ A~ âŸ§Ty~á´¾ âŸ¦ B~ âŸ§Ty~á´¾
âŸ¦ A~ [ Î´~ ]         âŸ§Ty~á´¾ = {!!}
âŸ¦ ğ”¹[]               âŸ§Ty~á´¾ = refl
âŸ¦ [][]              âŸ§Ty~á´¾ = refl
âŸ¦ [id]              âŸ§Ty~á´¾ = refl


âŸ¦ rfl~         âŸ§Tm~á´¾ = refl
âŸ¦ sym~ t~      âŸ§Tm~á´¾ = {!   !}
âŸ¦ tâ‚â‚‚~ âˆ™~ tâ‚‚â‚ƒ~ âŸ§Tm~á´¾ = {!   !}
âŸ¦ coh          âŸ§Tm~á´¾ = {!   !}
âŸ¦ rw x         âŸ§Tm~á´¾ = {!   !}
âŸ¦ TT Î“~        âŸ§Tm~á´¾ = refl
âŸ¦ FF Î“~        âŸ§Tm~á´¾ = refl
âŸ¦ if t~ u~ v~  âŸ§Tm~á´¾ = {!   !}
âŸ¦ t~ [ Î´~ ]    âŸ§Tm~á´¾ = {!   !}
âŸ¦ Ï€â‚‚rw Î´       âŸ§Tm~á´¾ = {!   !}
âŸ¦ TT[]         âŸ§Tm~á´¾ = {!   !}
âŸ¦ FF[]         âŸ§Tm~á´¾ = {!   !}
âŸ¦ [id]         âŸ§Tm~á´¾ = {!   !}
âŸ¦ [][]         âŸ§Tm~á´¾ = {!   !}
âŸ¦ ifTT         âŸ§Tm~á´¾ = {!   !}
âŸ¦ ifFF         âŸ§Tm~á´¾ = {!   !}
âŸ¦ Ï€â‚‚â¨¾          âŸ§Tm~á´¾ = {!   !}

